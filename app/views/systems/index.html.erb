<div id="top_navigation">
  <%= render_navigation(:level => 1) %>
</div>

<p>
<table id="server_list" class="display">
  <thead>
    <tr>
      <td>Host</td>
      <td>Department</td>
      <td>Technical Team</td>
      <td>Advocate</td>
      <td>SLA Level</td>
      <td>Environment</td>
      <td>Project</td>
      <td>CPUs</td>
      <td>Memory</td>
      <td>Next Upgrade</td>
      <td>Packages</td>
    </tr>
  </thead>
  <tbody>
    <% @servers.keys.sort.each do |hostname| %>
      <tr>
        <td><%= link_to(shorthost(hostname), server_path(shorthost(hostname))) %></td>
        <td><%= check_child(@servers[hostname]['puppetfacts'], 'department') %></td>
        <td><%= check_child(@servers[hostname]['puppetfacts'], 'technical_team') %></td>
        <td><%= check_child(@servers[hostname]['puppetfacts'], 'user_advocate') %></td>
        <td><%= check_child(@servers[hostname]['puppetfacts'], 'sla_level') %></td>
        <td><%= check_child(@servers[hostname]['puppetfacts'], 'environment') %></td>
        <td><%= check_child(@servers[hostname]['puppetfacts'], 'project') %></td>
        <td><%= check_child(@servers[hostname]['vmware'], 'memory') %></td>
        <td><%= check_child(@servers[hostname]['vmware'], 'cpus') %></td>
        <td><%= check_child(@servers[hostname]['upgrades'], 'date') %></td>
        <td><%= check_child(@servers[hostname]['upgrades'], 'packages')
          if @servers[hostname]['upgrades'].key?('packages')
            count = @servers[hostname]['upgrades']['packages'].count
            if count > 0
              link_to(count, upgrade_path(shorthost(hostname)))
            else
              0
            end
          end
        %></td>
      </tr>
    <% end %>
  </tbody>
</table>
